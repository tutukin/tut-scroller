{"version":3,"file":"tut-scroller.min.js","sources":["../../src/js/tutScroller.js","../../src/js/tutScrollerDirective.js","../../src/js/tutScrollerController.js"],"names":["angular","module","directive","$compile","$templateCache","compile","tElement","tAttrs","templateId","tutScrollerTemplate","link","scope","iElement","wrapper","find","window","collection","items","addClass","css","windowWidth","width","contentWidth","currentShift","forEach","item","i","el","_getItemTemplate","pos","_hide","_showAt","getX","append","itemWidth","Math","floor","length","on","ev","which","origin","reference","pageX","maxShift","_stopEvent","_release","s","_shift","abs","stopPropagation","preventDefault","type","selectItem","_getItemByElement","target","element","index","html","get","defaultTemplateHtml","itemScope","$new","hasClass","left","removeClass","each","$","this","translate","restrict","controller","template","$scope","shift","n","right"],"mappings":"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","sourcesContent":["angular.module('tutScroller', []);\n","angular.module('tutScroller').directive('tutScroller',\n['$compile', '$templateCache',\nfunction ($compile, $templateCache) {\n    var defaultTemplateHtml = '<div class=\"item\">{{item}}</div>';\n    var templateId;\n    var itemTemplate;\n\n    function compile (tElement, tAttrs) {\n        templateId = tAttrs.tutScrollerTemplate || null;\n        return link;\n    }\n\n    function link (scope, iElement, iAttrs, controller, transcludeFn) {\n        var wrapper = iElement.find('.items');\n        var window = iElement.find('.window');\n        var collection = scope.items || [];\n\n        iElement.addClass('tut-scroller');\n        iElement.css('position', 'relative');\n\n        // FIXME: jQuery dep: .width()\n        //Â default - to make unit tests work\n        scope.windowWidth = window.width() || 400;\n        scope.contentWidth = 0;\n        scope.currentShift = 0;\n\n        angular.forEach(collection, function (item, i) {\n            var el = _getItemTemplate(scope, item, i);\n            el.addClass('item');\n            scope.pos[i] = scope.contentWidth;\n            if ( scope.pos[i] >= scope.windowWidth ) {\n                _hide(el);\n            }\n            else {\n                _showAt(el, scope.getX(i));\n            }\n            // FIXME: .width() comes from jQuery. Use .css()\n            // FIXME: note, jqLite.css supports INLINE styles only!!!\n            scope.contentWidth += el.width();\n            wrapper.append(el);\n        });\n\n        scope.itemWidth = Math.floor(scope.contentWidth / collection.length);\n\n        wrapper.on('mousedown', function (ev) {\n            if ( ev.which !== 1 ) {\n                return;\n            }\n\n            scope.origin = scope.reference = ev.pageX;\n            scope.maxShift = 0;\n\n            return _stopEvent(ev);\n        });\n\n        wrapper.on('mouseup', function (ev) {\n            return _release(iElement, scope, ev);\n        });\n\n        wrapper.on('mouseleave', function (ev) {\n            return _release(iElement, scope, ev);\n        });\n\n        wrapper.on('mousemove', function (ev) {\n            var s;\n\n            if ( scope.reference === null ) {\n                return;\n            }\n\n            _shift(iElement, scope, ev.pageX - scope.reference);\n            scope.reference = ev.pageX;\n\n            s = Math.abs(scope.reference - scope.origin);\n            scope.maxShift = s > scope.maxShift ?\n                s : scope.maxShift;\n\n            return _stopEvent(ev);\n        });\n\n        iElement.find('a.move-left').on('click', function (ev) {\n            _shift(iElement, scope, -scope.itemWidth);\n        });\n\n        iElement.find('a.move-right').on('click', function (ev) {\n            _shift(iElement, scope, scope.itemWidth);\n        });\n    }\n\n\n    function _stopEvent (ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        return false;\n    }\n\n    function _release(iElement, scope, ev) {\n        if ( scope.reference === null ) {\n            return;\n        }\n        if ( scope.maxShift < Math.floor(0.05 * scope.itemWidth) ) {\n            _shift(iElement, scope, scope.origin - scope.reference );\n            if ( ev.type === 'mouseup' ) {\n                scope.selectItem({\n                    item : _getItemByElement(scope, ev.target)\n                });\n            }\n        }\n        scope.reference = null;\n        return _stopEvent(ev);\n    }\n\n    function _getItemByElement (scope, el) {\n        var s = angular.element(el).scope();\n        return s.item;\n    }\n\n\n\n\n    function _getItemTemplate (scope, item, index) {\n        var html = typeof templateId === 'string' ?\n            $templateCache.get(templateId) : defaultTemplateHtml;\n\n        var itemScope = scope.$new(true);\n        itemScope.item = item;\n        itemScope.index = index;\n\n        var el = $compile(html)(itemScope);\n\n        return el;\n    }\n\n\n    function _hide (el) {\n        if ( ! el.hasClass('hidden') ) {\n            el.addClass('hidden');\n        }\n    }\n\n    function _showAt (el, left) {\n        el.removeClass('hidden');\n        el.css('left', '' + left + 'px');\n    }\n\n    function _shift (iElement, scope, s) {\n        iElement.find('.item').each( function (i) {\n            var el = $(this);\n            var left = scope.pos[i] = scope.translate(scope.pos[i] + s);\n            if ( left >= scope.windowWidth ) {\n                _hide(el);\n            }\n            else {\n                _showAt(el, left);\n            }\n        });\n    }\n\n\n\n    return {\n        restrict:   'A',\n        compile:    compile,\n        scope:      {\n            items:      '=tutScroller',\n            selectItem: '&tutScrollerSelect'\n        },\n        controller: 'tutScrollerController',\n        template:\n            '<div class=\"window\">' +\n                '<div class=\"items\"></div>' +\n            '</div>' +\n            '<a href=\"#\" class=\"move-right\"></a>' +\n            '<a href=\"#\" class=\"move-left\"></a>'\n    };\n}]);\n","angular.module('tutScroller').controller('tutScrollerController',[\n    '$scope',\n    function ($scope) {\n        $scope.shift    = 0;\n        $scope.pos      = [];\n        $scope.reference= null;\n\n        $scope.getX     = function getX (n) {\n            return $scope.pos[n] + $scope.shift;\n        };\n\n        $scope.translate= function move (s) {\n            var left = ($scope.shift + s) % $scope.contentWidth;\n            var right = left + $scope.itemWidth;\n\n            if ( left <= -$scope.itemWidth ) {\n                left += $scope.contentWidth;\n            }\n\n            if ( left < $scope.contentWidth && right > $scope.contentWidth ) {\n                left -= $scope.contentWidth;\n            }\n\n            return left;\n        };\n    }\n])\n"]}