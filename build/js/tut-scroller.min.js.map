{"version":3,"file":"tut-scroller.min.js","sources":["../../src/js/tutScroller.js","../../src/js/tutScrollerDirective.js","../../src/js/tutScrollerController.js"],"names":["angular","module","directive","$compile","$templateCache","compile","tElement","tAttrs","templateId","tutScrollerTemplate","link","scope","iElement","iAttrs","wrapper","find","collection","tutScroller","addClass","css","windowWidth","contentWidth","currentShift","forEach","item","i","el","_getItemTemplate","pos","_hide","_showAt","getX","width","append","itemWidth","Math","floor","length","on","ev","which","origin","reference","pageX","maxShift","_stopEvent","_release","s","_shift","abs","stopPropagation","preventDefault","type","selectItem","_getItemByElement","target","element","index","html","get","defaultTemplateHtml","itemScope","$new","hasClass","left","removeClass","each","$","this","translate","restrict","items","controller","template","$scope","shift","n","res"],"mappings":"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","sourcesContent":["angular.module('tutScroller', []);\n","angular.module('tutScroller').directive('tutScroller',\n['$compile', '$templateCache',\nfunction ($compile, $templateCache) {\n    var defaultTemplateHtml = '<div class=\"item\">{{item}}</div>';\n    var templateId;\n    var itemTemplate;\n\n    function compile (tElement, tAttrs) {\n        templateId = tAttrs.tutScrollerTemplate || null;\n        return link;\n    }\n\n    function link (scope, iElement, iAttrs, controller, transcludeFn) {\n        var wrapper = iElement.find('.items');\n        var collection = scope[iAttrs.tutScroller] || [];\n\n        iElement.addClass('tut-scroller');\n        iElement.css('position', 'relative');\n\n        //scope.windowWidth = wrapper.width();\n        // todo: calculate it!\n        scope.windowWidth = 400;\n        scope.contentWidth = 0;\n        scope.currentShift = 0;\n\n        angular.forEach(collection, function (item, i) {\n            var el = _getItemTemplate(scope, item, i);\n            scope.pos[i] = scope.contentWidth;\n            if ( scope.pos[i] >= scope.windowWidth ) {\n                _hide(el);\n            }\n            else {\n                _showAt(el, scope.getX(i));\n            }\n            // FIXME: .width() comes from jQuery. Use .css()\n            // FIXME: note, jqLite.css supports INLINE styles only!!!\n            scope.contentWidth += el.width();\n            wrapper.append(el);\n        });\n\n        scope.itemWidth = Math.floor(scope.contentWidth / collection.length);\n\n        wrapper.on('mousedown', function (ev) {\n            if ( ev.which !== 1 ) {\n                return;\n            }\n\n            scope.origin = scope.reference = ev.pageX;\n            scope.maxShift = 0;\n\n            return _stopEvent(ev);\n        });\n\n        wrapper.on('mouseup', function (ev) {\n            return _release(iElement, scope, ev);\n        });\n\n        wrapper.on('mouseleave', function (ev) {\n            return _release(iElement, scope, ev);\n        });\n\n        wrapper.on('mousemove', function (ev) {\n            var s;\n\n            if ( scope.reference === null ) {\n                return;\n            }\n\n            _shift(iElement, scope, ev.pageX - scope.reference);\n            scope.reference = ev.pageX;\n\n            s = Math.abs(scope.reference - scope.origin);\n            scope.maxShift = s > scope.maxShift ?\n                s : scope.maxShift;\n\n            return _stopEvent(ev);\n        });\n\n        iElement.find('a.move-left').on('click', function (ev) {\n            _shift(iElement, scope, -scope.itemWidth);\n        });\n\n        iElement.find('a.move-right').on('click', function (ev) {\n            _shift(iElement, scope, scope.itemWidth);\n        });\n    }\n\n\n    function _stopEvent (ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        return false;\n    }\n\n    function _release(iElement, scope, ev) {\n        if ( scope.reference === null ) {\n            return;\n        }\n        if ( scope.maxShift < Math.floor(0.05 * scope.itemWidth) ) {\n            _shift(iElement, scope, scope.origin - scope.reference );\n            if ( ev.type === 'mouseup' ) {\n                scope.selectItem({\n                    item : _getItemByElement(scope, ev.target)\n                });\n            }\n        }\n        scope.reference = null;\n        return _stopEvent(ev);\n    }\n\n    function _getItemByElement (scope, el) {\n        var s = angular.element(el).scope();\n        return s.item;\n    }\n\n\n\n\n    function _getItemTemplate (scope, item, index) {\n        var html = typeof templateId === 'string' ?\n            $templateCache.get(templateId) : defaultTemplateHtml;\n\n        var itemScope = scope.$new(true);\n        itemScope.item = item;\n        itemScope.index = index;\n\n        var el = $compile(html)(itemScope);\n\n        return el;\n    }\n\n\n    function _hide (el) {\n        if ( ! el.hasClass('hidden') ) {\n            el.addClass('hidden');\n        }\n    }\n\n    function _showAt (el, left) {\n        el.removeClass('hidden');\n        el.css('left', '' + left + 'px');\n    }\n\n    function _shift (iElement, scope, s) {\n        iElement.find('.item').each( function (i) {\n            var el = $(this);\n            var left = scope.pos[i] = scope.translate(scope.pos[i] + s);\n            if ( left >= scope.windowWidth ) {\n                _hide(el);\n            }\n            else {\n                _showAt(el, left);\n            }\n        });\n    }\n\n\n\n    return {\n        restrict:   'A',\n        compile:    compile,\n        scope:      {\n            items:      '=tutScroller',\n            selectItem: '&tutScrollerSelect'\n        },\n        controller: 'tutScrollerController',\n        template:\n            '<div class=\"window\">' +\n                '<div class=\"items\"></div>' +\n            '</div>' +\n            '<a href=\"#\" class=\"move-right\"></a>' +\n            '<a href=\"#\" class=\"move-left\"></a>'\n    };\n}]);\n","angular.module('tutScroller').controller('tutScrollerController',[\n    '$scope',\n    function ($scope) {\n        $scope.shift    = 0;\n        $scope.pos      = [];\n        $scope.reference= null;\n\n        $scope.getX     = function getX (n) {\n            return $scope.pos[n] + $scope.shift;\n        };\n\n        $scope.translate= function move (s) {\n            var res = ($scope.shift + s) % $scope.contentWidth;\n            if ( res <= -$scope.itemWidth ) {\n                res += $scope.contentWidth;\n            }\n            return res;\n        };\n    }\n])\n"]}