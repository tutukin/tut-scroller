{"version":3,"file":"tut-scroller.min.js","sources":["../../src/js/tutScroller.js","../../src/js/tutScrollerDirective.js","../../src/js/tutScrollerController.js"],"names":["angular","module","directive","$compile","$templateCache","compile","tElement","tAttrs","templateId","tutScrollerTemplate","link","scope","iElement","wrapper","find","collection","items","addClass","css","windowWidth","width","contentWidth","currentShift","forEach","item","i","el","_getItemTemplate","pos","_hide","_showAt","getX","append","itemWidth","Math","floor","length","on","ev","which","origin","reference","pageX","maxShift","_stopEvent","_release","s","_shift","abs","stopPropagation","preventDefault","type","selectItem","_getItemByElement","target","element","index","html","get","defaultTemplateHtml","itemScope","$new","hasClass","left","removeClass","each","$","this","translate","restrict","controller","template","$scope","shift","n","res"],"mappings":"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","sourcesContent":["angular.module('tutScroller', []);\n","angular.module('tutScroller').directive('tutScroller',\n['$compile', '$templateCache',\nfunction ($compile, $templateCache) {\n    var defaultTemplateHtml = '<div class=\"item\">{{item}}</div>';\n    var templateId;\n    var itemTemplate;\n\n    function compile (tElement, tAttrs) {\n        templateId = tAttrs.tutScrollerTemplate || null;\n        return link;\n    }\n\n    function link (scope, iElement, iAttrs, controller, transcludeFn) {\n        var wrapper = iElement.find('.items');\n        var collection = scope.items || [];\n\n        iElement.addClass('tut-scroller');\n        iElement.css('position', 'relative');\n\n        // FIXME: jQuery dep: .width()\n        //Â default - to make unit tests work\n        scope.windowWidth = wrapper.width() || 400;\n        scope.contentWidth = 0;\n        scope.currentShift = 0;\n\n        angular.forEach(collection, function (item, i) {\n            var el = _getItemTemplate(scope, item, i);\n            el.addClass('item');\n            scope.pos[i] = scope.contentWidth;\n            if ( scope.pos[i] >= scope.windowWidth ) {\n                _hide(el);\n            }\n            else {\n                _showAt(el, scope.getX(i));\n            }\n            // FIXME: .width() comes from jQuery. Use .css()\n            // FIXME: note, jqLite.css supports INLINE styles only!!!\n            scope.contentWidth += el.width();\n            wrapper.append(el);\n        });\n\n        scope.itemWidth = Math.floor(scope.contentWidth / collection.length);\n\n        wrapper.on('mousedown', function (ev) {\n            if ( ev.which !== 1 ) {\n                return;\n            }\n\n            scope.origin = scope.reference = ev.pageX;\n            scope.maxShift = 0;\n\n            return _stopEvent(ev);\n        });\n\n        wrapper.on('mouseup', function (ev) {\n            return _release(iElement, scope, ev);\n        });\n\n        wrapper.on('mouseleave', function (ev) {\n            return _release(iElement, scope, ev);\n        });\n\n        wrapper.on('mousemove', function (ev) {\n            var s;\n\n            if ( scope.reference === null ) {\n                return;\n            }\n\n            _shift(iElement, scope, ev.pageX - scope.reference);\n            scope.reference = ev.pageX;\n\n            s = Math.abs(scope.reference - scope.origin);\n            scope.maxShift = s > scope.maxShift ?\n                s : scope.maxShift;\n\n            return _stopEvent(ev);\n        });\n\n        iElement.find('a.move-left').on('click', function (ev) {\n            _shift(iElement, scope, -scope.itemWidth);\n        });\n\n        iElement.find('a.move-right').on('click', function (ev) {\n            _shift(iElement, scope, scope.itemWidth);\n        });\n    }\n\n\n    function _stopEvent (ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        return false;\n    }\n\n    function _release(iElement, scope, ev) {\n        if ( scope.reference === null ) {\n            return;\n        }\n        if ( scope.maxShift < Math.floor(0.05 * scope.itemWidth) ) {\n            _shift(iElement, scope, scope.origin - scope.reference );\n            if ( ev.type === 'mouseup' ) {\n                scope.selectItem({\n                    item : _getItemByElement(scope, ev.target)\n                });\n            }\n        }\n        scope.reference = null;\n        return _stopEvent(ev);\n    }\n\n    function _getItemByElement (scope, el) {\n        var s = angular.element(el).scope();\n        return s.item;\n    }\n\n\n\n\n    function _getItemTemplate (scope, item, index) {\n        var html = typeof templateId === 'string' ?\n            $templateCache.get(templateId) : defaultTemplateHtml;\n\n        var itemScope = scope.$new(true);\n        itemScope.item = item;\n        itemScope.index = index;\n\n        var el = $compile(html)(itemScope);\n\n        return el;\n    }\n\n\n    function _hide (el) {\n        if ( ! el.hasClass('hidden') ) {\n            el.addClass('hidden');\n        }\n    }\n\n    function _showAt (el, left) {\n        el.removeClass('hidden');\n        el.css('left', '' + left + 'px');\n    }\n\n    function _shift (iElement, scope, s) {\n        iElement.find('.item').each( function (i) {\n            var el = $(this);\n            var left = scope.pos[i] = scope.translate(scope.pos[i] + s);\n            if ( left >= scope.windowWidth ) {\n                _hide(el);\n            }\n            else {\n                _showAt(el, left);\n            }\n        });\n    }\n\n\n\n    return {\n        restrict:   'A',\n        compile:    compile,\n        scope:      {\n            items:      '=tutScroller',\n            selectItem: '&tutScrollerSelect'\n        },\n        controller: 'tutScrollerController',\n        template:\n            '<div class=\"window\">' +\n                '<div class=\"items\"></div>' +\n            '</div>' +\n            '<a href=\"#\" class=\"move-right\"></a>' +\n            '<a href=\"#\" class=\"move-left\"></a>'\n    };\n}]);\n","angular.module('tutScroller').controller('tutScrollerController',[\n    '$scope',\n    function ($scope) {\n        $scope.shift    = 0;\n        $scope.pos      = [];\n        $scope.reference= null;\n\n        $scope.getX     = function getX (n) {\n            return $scope.pos[n] + $scope.shift;\n        };\n\n        $scope.translate= function move (s) {\n            var res = ($scope.shift + s) % $scope.contentWidth;\n            if ( res <= -$scope.itemWidth ) {\n                res += $scope.contentWidth;\n            }\n            return res;\n        };\n    }\n])\n"]}