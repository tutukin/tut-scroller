{"version":3,"file":"tut-scroller.min.js","sources":["../../src/js/tutScrollerDirective.js"],"names":["angular","module","directive","$compile","$templateCache","$window","PM","Scroller","link","scope","iElement","iAttrs","selectItem","target","item","element","_linkItems","collection","items","forEach","i","el","_getItemTemplate","addClass","wrapper","append","scroller","addItem","index","itemScope","$new","itemTemplate","find","viewport","windowWidth","width","getItemSize","showItemAt","hideItem","tutScrollerTemplate","get","defaultTemplateHtml","css","$watch","addEventListener","w","setWindowWidth","pointer","attachTo","clickThreshold","Math","floor","itemWidth","onmove","s","scroll","onclick","on","getMeanItemWidth","autoscroll","Date","now","hasClass","left","removeClass","restrict","template"],"mappings":"AAAAA,QAAQC,OAAO,eAAeC,UAAU,eACvC,WAAY,iBAAkB,UAAW,mBAAoB,WAC9D,SAAUC,EAAUC,EAAgBC,EAASC,EAAIC,GAG7C,QAASC,GAAMC,EAAOC,EAAUC,GAmC5B,QAASC,GAAYC,GACjB,GAAIC,GAAOd,QAAQe,QAAQF,GAAQJ,QAAQK,IAE3CL,GAAMG,YACFE,KAAOA,IAcf,QAASE,KACL,GAAIC,GAAaR,EAAMS,SAEvBlB,SAAQmB,QAAQF,EAAY,SAAUH,EAAMM,GACxC,GAAIC,GAAKC,EAAiBR,EAAMM,EAChCC,GAAGE,SAAS,QACZC,EAAQC,OAAOJ,GACfK,EAASC,QAAQN,KAIzB,QAASC,GAAkBR,EAAMc,GAC7B,GAAIC,GAAYpB,EAAMqB,MAAK,EAC3BD,GAAUf,KAAOA,EACjBe,EAAUD,MAAQA,CAElB,IAAIP,GAAKlB,EAAS4B,GAAcF,EAEhC,OAAOR,GAtEX,GAAIG,GAAUd,EAASsB,KAAK,UACxBC,EAAWvB,EAASsB,KAAK,WAEzBN,EAAW,GAAInB,GAASA,UACxB2B,YAAgBD,EAASE,QACzBC,YAAgBA,EAChBC,WAAgBA,EAChBC,SAAgBA,IAGhBP,EAAepB,EAAO4B,oBACtBnC,EAAeoC,IAAI7B,EAAO4B,qBAC1BE,CAEJ/B,GAASa,SAAS,gBAClBb,EAASgC,IAAI,WAAY,YAEzBjC,EAAMkC,OAAO,QAAS,WAClB3B,MAGJX,EAAQuC,iBAAiB,SAAU,WAGjC,GAAIC,GAAIZ,EAASE,OACjBT,GAASoB,eAAeD,IAG1B,IAAIE,GAAUzC,EAAG0C,SAASxB,GACtByB,eAAgBC,KAAKC,MAAM,IAAO1C,EAAM2C,YAAc,EACtDC,OAAQ,SAAiBC,GAAK5B,EAAS6B,OAAOD,IAC9CE,QAAQ5C,GAWZF,GAASsB,KAAK,eAAeyB,GAAG,QAAS,WACrC,GAAIZ,GAAInB,EAASgC,kBACjBX,GAAQY,YAAYd,EAAGe,KAAKC,SAGhCnD,EAASsB,KAAK,gBAAgByB,GAAG,QAAS,WACtC,GAAIZ,GAAInB,EAASgC,kBACjBX,GAAQY,WAAWd,EAAGe,KAAKC,SA0BnC,QAASvB,GAAUjB,GACRA,EAAGyC,SAAS,WACfzC,EAAGE,SAAS,UAIpB,QAASc,GAAY0B,EAAM1C,GACvBA,EAAG2C,YAAY,UACf3C,EAAGqB,IAAI,OAAQ,GAAKqB,EAAO,MAG/B,QAAS3B,GAAaf,GAClB,MAAOA,GAAGc,QA1Fd,GAAIM,GAAsB,kCAgG1B,QACIwB,SAAY,IACZzD,KAAYA,EACZC,OACIS,MAAY,eACZN,WAAY,sBAEhBsD,SACI","sourcesContent":["angular.module('tutScroller').directive('tutScroller',\n['$compile', '$templateCache', '$window', 'PointerMovements', 'Scroller',\nfunction ($compile, $templateCache, $window, PM, Scroller) {\n    var defaultTemplateHtml = '<div class=\"item\">{{item}}</div>';\n\n    function link (scope, iElement, iAttrs, controller, transcludeFn) {\n        var wrapper = iElement.find('.items');\n        var viewport = iElement.find('.window');\n\n        var scroller = new Scroller.Scroller({\n            windowWidth:    viewport.width(),\n            getItemSize:    getItemSize,\n            showItemAt:     showItemAt,\n            hideItem:       hideItem\n        });\n\n        var itemTemplate = iAttrs.tutScrollerTemplate ?\n            $templateCache.get(iAttrs.tutScrollerTemplate) :\n            defaultTemplateHtml;\n\n        iElement.addClass('tut-scroller');\n        iElement.css('position', 'relative');\n\n        scope.$watch('items', function (a, b) {\n            _linkItems();\n        });\n\n        $window.addEventListener('resize', function () {\n          // FIXME: check if windowWidth has changed\n          // FIXME: use requestAnimationFrame to defer DOM manipulations\n          var w = viewport.width();\n          scroller.setWindowWidth(w);\n        });\n\n        var pointer = PM.attachTo(wrapper, {\n            clickThreshold: Math.floor(0.05 * scope.itemWidth) || 8, // Fixme: scope.itemWidth is not available right now\n            onmove: function _shift (s) { scroller.scroll(s); },\n            onclick:selectItem\n        });\n\n        function selectItem (target) {\n            var item = angular.element(target).scope().item;\n\n            scope.selectItem({\n                item : item\n            });\n        }\n\n        iElement.find('a.move-left').on('click', function (ev) {\n            var w = scroller.getMeanItemWidth();\n            pointer.autoscroll(-w, Date.now());\n        });\n\n        iElement.find('a.move-right').on('click', function (ev) {\n            var w = scroller.getMeanItemWidth();\n            pointer.autoscroll(w, Date.now());\n        });\n\n        function _linkItems () {\n            var collection = scope.items || [];\n\n            angular.forEach(collection, function (item, i) {\n                var el = _getItemTemplate(item, i);\n                el.addClass('item');\n                wrapper.append(el);\n                scroller.addItem(el);\n            });\n        }\n\n        function _getItemTemplate (item, index) {\n            var itemScope = scope.$new(true);\n            itemScope.item = item;\n            itemScope.index = index;\n\n            var el = $compile(itemTemplate)(itemScope);\n\n            return el;\n        }\n    }\n\n\n    function hideItem (el) {\n        if ( ! el.hasClass('hidden') ) {\n            el.addClass('hidden');\n        }\n    }\n\n    function showItemAt (left, el) {\n        el.removeClass('hidden');\n        el.css('left', '' + left + 'px');\n    }\n\n    function getItemSize (el) {\n        return el.width();\n    }\n\n\n\n\n    return {\n        restrict:   'A',\n        link:       link,\n        scope:      {\n            items:      '=tutScroller',\n            selectItem: '&tutScrollerSelect'\n        },\n        template:\n            '<div class=\"window\">' +\n                '<div class=\"items\"></div>' +\n            '</div>' +\n            '<a href=\"#\" class=\"move-right\"><span class=\"icon\"></span></a>' +\n            '<a href=\"#\" class=\"move-left\"><span class=\"icon\"></span></a>'\n    };\n}]);\n"]}